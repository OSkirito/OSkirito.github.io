<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="CG技术的记录与分享">
<meta property="og:type" content="website">
<meta property="og:title" content="OS&#39;s Blog">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="OS&#39;s Blog">
<meta property="og:description" content="CG技术的记录与分享">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="OSkirito">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>OS's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">OS's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/home/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">18</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">42</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/15/1-1-VisualStudio%E4%B8%AD%E5%A4%84%E7%90%86OpenGL%E7%9D%80%E8%89%B2%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/15/1-1-VisualStudio%E4%B8%AD%E5%A4%84%E7%90%86OpenGL%E7%9D%80%E8%89%B2%E5%99%A8/" class="post-title-link" itemprop="url">1-1-VisualStudio中处理OpenGL着色器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-11-15 13:44:54 / 修改时间：18:18:44" itemprop="dateCreated datePublished" datetime="2023-11-15T13:44:54+08:00">2023-11-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在VisualStudio中打开配置的项目，新建文件结构并新建文件，将着色器源代码移动到该文件中</p>
<img src="/2023/11/15/1-1-VisualStudio%E4%B8%AD%E5%A4%84%E7%90%86OpenGL%E7%9D%80%E8%89%B2%E5%99%A8/image-20231115135209249.png" class="" title="image-20231115135209249">

<img src="/2023/11/15/1-1-VisualStudio%E4%B8%AD%E5%A4%84%E7%90%86OpenGL%E7%9D%80%E8%89%B2%E5%99%A8/image-20231115141709148.png" class="" title="image-20231115141709148">

<p>在运行程序中对shader文件进行读取，使用如下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 着色器源程序的结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ShaderProgramSource</span></span><br><span class="line">&#123;</span><br><span class="line">    std::string Vertexsource;</span><br><span class="line">    std::string Fragmentsource;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取着色器源代码</span></span><br><span class="line"><span class="function"><span class="type">static</span> ShaderProgramSource <span class="title">ParseShader</span><span class="params">(<span class="type">const</span> std::string&amp; filepath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">stream</span><span class="params">(filepath)</span></span>;<span class="comment">/* 这里没判断文件是否能正常打开 is_open */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">enum class</span> <span class="title class_">ShaderType</span></span><br><span class="line">    &#123;</span><br><span class="line">        NONE = <span class="number">-1</span>, VERTEX = <span class="number">0</span>, FRAGMENT = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    std::string line;</span><br><span class="line">    std::stringstream ss[<span class="number">2</span>];</span><br><span class="line">    ShaderType type = ShaderType::NONE;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">getline</span>(stream, line))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="built_in">find</span>(<span class="string">&quot;#shader&quot;</span>) != std::string::npos)<span class="comment">/* 找到#shader标记 */</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (line.<span class="built_in">find</span>(<span class="string">&quot;vertex&quot;</span>) != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                type = ShaderType::VERTEX;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (line.<span class="built_in">find</span>(<span class="string">&quot;fragment&quot;</span>) != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                type = ShaderType::FRAGMENT;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            ss[(<span class="type">int</span>)type] &lt;&lt; line &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; ss[<span class="number">0</span>].<span class="built_in">str</span>(),ss[<span class="number">1</span>].<span class="built_in">str</span>() &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在原本使用着色器的地方修改代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从文件解析着色器源代码</span></span><br><span class="line">ShaderProgramSource source = <span class="built_in">ParseShader</span>(<span class="string">&quot;res/shaders/Basic.shader&quot;</span>);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> shader = <span class="built_in">CreateShader</span>(source.Vertexsource, source.Fragmentsource);</span><br><span class="line"><span class="built_in">glUseProgram</span>(shader);</span><br></pre></td></tr></table></figure>

<p>修改shader文件中片段着色器输出的颜色，运行验证如下图所示：</p>
<img src="/2023/11/15/1-1-VisualStudio%E4%B8%AD%E5%A4%84%E7%90%86OpenGL%E7%9D%80%E8%89%B2%E5%99%A8/image-20231115150810875.png" class="" title="image-20231115150810875">

<p>完整代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// include顺序不可互换，glfw依赖glew引入的OpenGL头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 着色器源程序的结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ShaderProgramSource</span></span><br><span class="line">&#123;</span><br><span class="line">    std::string Vertexsource;</span><br><span class="line">    std::string Fragmentsource;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取着色器源代码</span></span><br><span class="line"><span class="function"><span class="type">static</span> ShaderProgramSource <span class="title">ParseShader</span><span class="params">(<span class="type">const</span> std::string&amp; filepath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">stream</span><span class="params">(filepath)</span></span>;<span class="comment">/* 这里没判断文件是否能正常打开 is_open */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">enum class</span> <span class="title class_">ShaderType</span></span><br><span class="line">    &#123;</span><br><span class="line">        NONE = <span class="number">-1</span>, VERTEX = <span class="number">0</span>, FRAGMENT = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    std::string line;</span><br><span class="line">    std::stringstream ss[<span class="number">2</span>];</span><br><span class="line">    ShaderType type = ShaderType::NONE;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">getline</span>(stream, line))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="built_in">find</span>(<span class="string">&quot;#shader&quot;</span>) != std::string::npos)<span class="comment">/* 找到#shader标记 */</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (line.<span class="built_in">find</span>(<span class="string">&quot;vertex&quot;</span>) != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                type = ShaderType::VERTEX;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (line.<span class="built_in">find</span>(<span class="string">&quot;fragment&quot;</span>) != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                type = ShaderType::FRAGMENT;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            ss[(<span class="type">int</span>)type] &lt;&lt; line &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; ss[<span class="number">0</span>].<span class="built_in">str</span>(),ss[<span class="number">1</span>].<span class="built_in">str</span>() &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="title">CompileShader</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> type, <span class="type">const</span> std::string&amp; source)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建并编译着色器</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> id = <span class="built_in">glCreateShader</span>(type);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* src = source.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="built_in">glShaderSource</span>(id, <span class="number">1</span>, &amp;src, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">glCompileShader</span>(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否编译成功</span></span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(id, GL_COMPILE_STATUS, &amp;result);</span><br><span class="line">    <span class="keyword">if</span> (result == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="built_in">glGetShaderiv</span>(id, GL_INFO_LOG_LENGTH, &amp;length);</span><br><span class="line">        <span class="type">char</span>* message = (<span class="type">char</span>*)_malloca(length * <span class="built_in">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">        <span class="built_in">glGetShaderInfoLog</span>(id, length, &amp;length, message);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to compile&quot;</span> &lt;&lt; (type == GL_VERTEX_SHADER ? <span class="string">&quot;vertex&quot;</span> : <span class="string">&quot;fragment&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">glDeleteShader</span>(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="title">CreateShader</span><span class="params">(<span class="type">const</span> std::string&amp; vertexShader, <span class="type">const</span> std::string&amp; fragmentShader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建程序并编译着色器</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> program = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> vs = <span class="built_in">CompileShader</span>(GL_VERTEX_SHADER, vertexShader);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> fs = <span class="built_in">CompileShader</span>(GL_FRAGMENT_SHADER, fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 附加着色器链接程序</span></span><br><span class="line">    <span class="built_in">glAttachShader</span>(program, vs);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(program, fs);</span><br><span class="line">    <span class="built_in">glLinkProgram</span>(program);</span><br><span class="line">    <span class="built_in">glValidateProgram</span>(program);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否链接成功</span></span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(program, GL_LINK_STATUS, &amp;result);</span><br><span class="line">    <span class="keyword">if</span> (!result)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;length);</span><br><span class="line">        <span class="type">char</span>* message = (<span class="type">char</span>*)_malloca(length * <span class="built_in">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">        <span class="built_in">glGetProgramInfoLog</span>(program, <span class="number">512</span>, <span class="literal">NULL</span>, message);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ERROR::SHADER_PROGRAM_LINK_FAILED\n&quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glDeleteShader</span>(vs);</span><br><span class="line">    <span class="built_in">glDeleteShader</span>(fs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> program;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GLFWwindow* window;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initialize the library */</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Create a windowed mode window and its OpenGL context */</span></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(<span class="number">640</span>, <span class="number">480</span>, <span class="string">&quot;Hello World&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (!window)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Make the window&#x27;s context current */</span></span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    GLenum err = <span class="built_in">glewInit</span>();</span><br><span class="line">    <span class="keyword">if</span> (GLEW_OK != err) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; <span class="built_in">glewGetErrorString</span>(err) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Status: Using GLEW &quot;</span> &lt;&lt; <span class="built_in">glewGetString</span>(GLEW_VERSION) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Status: Using GL &quot;</span> &lt;&lt; <span class="built_in">glGetString</span>(GL_VERSION) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义顶点数组</span></span><br><span class="line">    <span class="type">float</span> vertices[] =</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">0.0f</span>,  <span class="number">0.5f</span>, <span class="number">0.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建顶点缓冲对象(VBO)</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> VBO;</span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;VBO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定到缓冲区</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, VBO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 填充数据</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置顶点数据指针</span></span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">float</span>), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从文件解析着色器源代码</span></span><br><span class="line">    ShaderProgramSource source = <span class="built_in">ParseShader</span>(<span class="string">&quot;res/shaders/Basic.shader&quot;</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> shader = <span class="built_in">CreateShader</span>(source.Vertexsource, source.Fragmentsource);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(shader);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Loop until the user closes the window */</span></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 渲染指令</span></span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制三角形、线、点</span></span><br><span class="line">        <span class="comment">// 使用设置的颜色来清空颜色缓冲</span></span><br><span class="line">        <span class="built_in">glClearColor</span>(<span class="number">0.2f</span>, <span class="number">0.3f</span>, <span class="number">0.3f</span>, <span class="number">1.0f</span>);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查并调用事件，交换缓冲</span></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">glDeleteProgram</span>(shader);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/" class="post-title-link" itemprop="url">00-00-在VisualStudio中配置OpenGL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-14 18:09:03" itemprop="dateCreated datePublished" datetime="2023-11-14T18:09:03+08:00">2023-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-15 18:06:31" itemprop="dateModified" datetime="2023-11-15T18:06:31+08:00">2023-11-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先下载[GLFW](<a target="_blank" rel="noopener" href="https://www.glfw.org/download.html">Download | GLFW</a>)</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921153030075.png" class="" title="image-20230921153030075">

<p>打开VisualStudio新建一个空C++项目</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114181547655.png" class="" title="image-20231114181547655">

<p>添加一个新项</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114192023072.png" class="" title="image-20231114192023072">

<p>运行代码测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;Hello&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	std::cin.<span class="built_in">get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114193441397.png" class="" title="image-20231114193441397">

<p>在项目文件夹下构造目录结构…\Dependencies\GLFW，将GLFW解压的如下文件拷贝到该目录并删除部分文件</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114194506167.png" class="" title="image-20231114194506167">

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114194647570.png" class="" title="image-20231114194647570">

<p>在VisualStudio中为项目添加链接</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114195837745.png" class="" title="image-20231114195837745">

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114200527897.png" class="" title="image-20231114200527897">

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114202219023.png" class="" title="image-20231114202219023">

<p>完成GLFW配置，输入以下代码验证</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GLFWwindow* window;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initialize the library */</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Create a windowed mode window and its OpenGL context */</span></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(<span class="number">640</span>, <span class="number">480</span>, <span class="string">&quot;Hello World&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (!window)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Make the window&#x27;s context current */</span></span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Loop until the user closes the window */</span></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Render here */</span></span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glBegin</span>(GL_TRIANGLES);</span><br><span class="line">        <span class="built_in">glVertex2f</span>(<span class="number">-0.5f</span>, <span class="number">-0.5f</span>);</span><br><span class="line">        <span class="built_in">glVertex2f</span>(<span class="number">0.5f</span>, <span class="number">-0.5f</span>);</span><br><span class="line">        <span class="built_in">glVertex2f</span>(<span class="number">0.0f</span>, <span class="number">0.5f</span>);</span><br><span class="line">        <span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Swap front and back buffers */</span></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Poll for and process events */</span></span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如下</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231114202311043.png" class="" title="image-20231114202311043">

<p>为了调用OpenGL函数还需要配置OpenGL扩展库，我们使用<a target="_blank" rel="noopener" href="https://glew.sourceforge.net/">GLEW</a></p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115104041325.png" class="" title="image-20231115104041325">

<p>解压后将文件夹拷贝到项目路径</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115104400233.png" class="" title="image-20231115104400233">

<p>在项目中继续添加链接</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115105221085.png" class="" title="image-20231115105221085">

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115105141920.png" class="" title="image-20231115105141920">

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115105449161.png" class="" title="image-20231115105449161">

<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115112328159.png" class="" title="image-20231115112328159">

<p>完成配置后，输入以下代码进行验证</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glew.h&gt;</span></span></span><br><span class="line"><span class="comment">// include顺序不可互换，glfw依赖glew引入的OpenGL头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="title">CompileShader</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> type, <span class="type">const</span> std::string&amp; source)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建并编译着色器</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> id = <span class="built_in">glCreateShader</span>(type);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* src = source.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="built_in">glShaderSource</span>(id, <span class="number">1</span>, &amp;src, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">glCompileShader</span>(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否编译成功</span></span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    <span class="built_in">glGetShaderiv</span>(id, GL_COMPILE_STATUS, &amp;result);</span><br><span class="line">    <span class="keyword">if</span> (result == GL_FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="built_in">glGetShaderiv</span>(id, GL_INFO_LOG_LENGTH, &amp;length);</span><br><span class="line">        <span class="type">char</span>* message = (<span class="type">char</span>*)_malloca(length * <span class="built_in">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">        <span class="built_in">glGetShaderInfoLog</span>(id, length, &amp;length, message);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to compile&quot;</span> &lt;&lt; (type == GL_VERTEX_SHADER ? <span class="string">&quot;vertex&quot;</span> : <span class="string">&quot;fragment&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">glDeleteShader</span>(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="title">CreateShader</span><span class="params">(<span class="type">const</span> std::string&amp; vertexShader, <span class="type">const</span> std::string&amp; fragmentShader)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建程序并编译着色器</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> program = <span class="built_in">glCreateProgram</span>();</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> vs = <span class="built_in">CompileShader</span>(GL_VERTEX_SHADER, vertexShader);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> fs = <span class="built_in">CompileShader</span>(GL_FRAGMENT_SHADER, fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 附加着色器链接程序</span></span><br><span class="line">    <span class="built_in">glAttachShader</span>(program, vs);</span><br><span class="line">    <span class="built_in">glAttachShader</span>(program, fs);</span><br><span class="line">    <span class="built_in">glLinkProgram</span>(program);</span><br><span class="line">    <span class="built_in">glValidateProgram</span>(program);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否链接成功</span></span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    <span class="built_in">glGetProgramiv</span>(program, GL_LINK_STATUS, &amp;result);</span><br><span class="line">    <span class="keyword">if</span> (!result)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="built_in">glGetProgramiv</span>(program, GL_INFO_LOG_LENGTH, &amp;length);</span><br><span class="line">        <span class="type">char</span>* message = (<span class="type">char</span>*)_malloca(length * <span class="built_in">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">        <span class="built_in">glGetProgramInfoLog</span>(program, <span class="number">512</span>, <span class="literal">NULL</span>, message);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ERROR::SHADER_PROGRAM_LINK_FAILED\n&quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glDeleteShader</span>(vs);</span><br><span class="line">    <span class="built_in">glDeleteShader</span>(fs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> program;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GLFWwindow* window;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initialize the library */</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">glfwInit</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Create a windowed mode window and its OpenGL context */</span></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(<span class="number">640</span>, <span class="number">480</span>, <span class="string">&quot;Hello World&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (!window)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Make the window&#x27;s context current */</span></span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    GLenum err = <span class="built_in">glewInit</span>();</span><br><span class="line">    <span class="keyword">if</span> (GLEW_OK != err) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; <span class="built_in">glewGetErrorString</span>(err) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Status: Using GLEW &quot;</span> &lt;&lt; <span class="built_in">glewGetString</span>(GLEW_VERSION) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Status: Using GL &quot;</span> &lt;&lt; <span class="built_in">glGetString</span>(GL_VERSION) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义顶点数组</span></span><br><span class="line">    <span class="type">float</span> vertices[] =</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">-0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">0.5f</span>, <span class="number">-0.5f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">0.0f</span>,  <span class="number">0.5f</span>, <span class="number">0.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建顶点缓冲对象(VBO)</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> VBO;</span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;VBO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定到缓冲区</span></span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, VBO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 填充数据</span></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置顶点数据指针</span></span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">float</span>), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将顶点着色器的源代码硬编码储存在字符串中</span></span><br><span class="line">    std::string vertexShader = </span><br><span class="line">        <span class="string">&quot;#version 330 core\n&quot;</span></span><br><span class="line">        <span class="string">&quot;layout (location = 0) in vec4 aPos;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;void main()\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;   gl_Position = aPos;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将片段着色器的源代码硬编码储存在字符串中</span></span><br><span class="line">    std::string fragmentShader = </span><br><span class="line">        <span class="string">&quot;#version 330 core\n&quot;</span></span><br><span class="line">        <span class="string">&quot;out vec4 FragColor;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;void main()\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;    FragColor = vec4(1.0f, 0.5f, 0.2f, 1.0f);\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> shader = <span class="built_in">CreateShader</span>(vertexShader, fragmentShader);</span><br><span class="line">    <span class="built_in">glUseProgram</span>(shader);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Loop until the user closes the window */</span></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 渲染指令</span></span><br><span class="line">        <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制三角形、线、点</span></span><br><span class="line">        <span class="comment">// 使用设置的颜色来清空颜色缓冲</span></span><br><span class="line">        <span class="built_in">glClearColor</span>(<span class="number">0.2f</span>, <span class="number">0.3f</span>, <span class="number">0.3f</span>, <span class="number">1.0f</span>);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查并调用事件，交换缓冲</span></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">glDeleteProgram</span>(shader);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下图所示</p>
<img src="/2023/11/14/00-%E5%9C%A8VisualStudio%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231115113830688.png" class="" title="image-20231115113830688">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/13/02-%E5%9F%BA%E7%A1%80%E7%9A%84OpenGL%E6%A1%86%E6%9E%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/13/02-%E5%9F%BA%E7%A1%80%E7%9A%84OpenGL%E6%A1%86%E6%9E%B6/" class="post-title-link" itemprop="url">02-基础的OpenGL框架</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-13 10:31:49" itemprop="dateCreated datePublished" datetime="2023-11-13T10:31:49+08:00">2023-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-11 17:06:24" itemprop="dateModified" datetime="2024-09-11T17:06:24+08:00">2024-09-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为了使用OpenGL，需要先了解如何编写一个OpenGL程序。</p>
<p>一个经典的shader有下面的结构：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version version_number</span></span><br><span class="line"><span class="keyword">in</span> type in_variable_name;</span><br><span class="line"><span class="keyword">in</span> type in_variable_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> type out_variable_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> type uniform_name;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 处理输入并进行一些图形操作</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 输出处理过的结果到输出变量</span></span><br><span class="line">  out_variable_name = weird_stuff_we_processed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想要运行shader程序，我们需要使用GLFW和glad创建一个窗口，在这个窗口中运行我们的着色器。</p>
<p>创建一个Windows窗口：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &lt;glad/glad.h&gt;</span></span><br><span class="line"><span class="comment">// include顺序不可互换，glfw依赖glad引入的OpenGL头文件</span></span><br><span class="line"><span class="meta">#include &lt;GLFW/glfw3.h&gt;</span></span><br><span class="line"><span class="comment">// 输入输出流</span></span><br><span class="line"><span class="meta">#include&lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height);</span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化GLFW</span></span><br><span class="line">    glfwInit();</span><br><span class="line">    <span class="comment">// 配置GLFWD使用的OpenGL主要和次要版本</span></span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 使用OpenGL核心模式</span></span><br><span class="line">    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line">    <span class="comment">// 使用向后兼容</span></span><br><span class="line">    <span class="comment">// glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个窗口对象，设置宽高标题</span></span><br><span class="line">    GLFWwindow* window = glfwCreateWindow(<span class="number">800</span>, <span class="number">600</span>, &quot;MyWindow&quot;, NULL, NULL);</span><br><span class="line">    <span class="keyword">if</span>(window == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果为空则创建失败并打印</span></span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to create GLFW window&quot; &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 关闭线程</span></span><br><span class="line">        glfwTerminate();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知GLFW将窗口的上下文设置为当前线程的主上下文</span></span><br><span class="line">    glfwMakeContextCurrent(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果GLAD初始化失败则打印</span></span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to initialize GLAD&quot; &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置视口</span></span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册窗口变化监听函数</span></span><br><span class="line">    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染循环，使GLFW退出前一直保持运行</span></span><br><span class="line">    <span class="keyword">while</span>(!glfwWindowShouldClose(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 每帧处理是否输入</span></span><br><span class="line">        processInput(window);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 渲染指令</span></span><br><span class="line">        <span class="comment">// 使用设置的颜色来清空颜色缓冲</span></span><br><span class="line">        glClearColor(<span class="number">0.2</span>f, <span class="number">0.3</span>f, <span class="number">0.3</span>f, <span class="number">1.0</span>f);</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查并调用事件，交换缓冲</span></span><br><span class="line">        glfwSwapBuffers(window);</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染循环结束后，关闭线程</span></span><br><span class="line">    glfwTerminate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对窗口注册一个回调函数，在每次窗口大小被调整的时候被调用，用于重新设置视口</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果输入“ESC”则关闭窗口</span></span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        glfwSetWindowShouldClose(window, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的程序中，我们首先引入了程序运行所依赖的头文件（<em>注意，include顺序不可互换，glfw依赖glad引入的OpenGL头文件</em>），然后对两个函数进行了声明（用于窗口与视口自适应调整以及程序结束按键设置）。</p>
<p>在主函数中，我们初始化GLFW，然后配置OpenGL使用的版本，创建窗口设置窗口和视口，在while语句中执行我们的渲染指令并且每帧刷新，在渲染结束后关闭线程。</p>
<p>运行结果如下图所示。</p>
<img src="/2023/11/13/02-%E5%9F%BA%E7%A1%80%E7%9A%84OpenGL%E6%A1%86%E6%9E%B6/image-20231113133805606.png" class="" title="image-20231113133805606">

<p>接下来我们在该窗口中绘制一个三角形来说明如何编写shader指令。</p>
<p>首先需要介绍三个常用的对象：</p>
<ul>
<li>顶点数组对象：Vertex Array Object，VAO</li>
<li>顶点缓冲对象：Vertex Buffer Object，VBO</li>
<li>元素缓冲对象：Element Buffer Object，EBO 或 索引缓冲对象 Index Buffer Object，IBO</li>
</ul>
<p>顶点数组对象(Vertex Array Object, VAO)可以被绑定，之后任何顶点属性的调用都会储存在这个VAO中。这样，当配置顶点属性指针时，只需要将那些调用执行一次，在绘制物体的时候只需要绑定相应的VAO就行了。绑定不同的VAO，可以实现不同顶点数据和属性配置之间的切换。</p>
<p>顶点缓冲对象(Vertex Buffer Objects, VBO)会在GPU内存（通常被称为显存）中储存大量顶点。通过这些缓冲可以一次性发送一大批数据到显卡上，而不是每个顶点发送一次。当数据发送至显卡的内存中后，顶点着色器几乎能立即访问顶点。</p>
<p>元素缓冲对象(Element Buffer Object，EBO)，也叫索引缓冲对象(Index Buffer Object，IBO)，像顶点缓冲区对象，存储 OpenGL 要绘制哪些顶点的索引。例如，仅用四个顶点就可以绘制一个由两个三角形组成的矩形。</p>
<p>在主函数之前需要将shader源代码硬编码储存在字符串中，如下是一个顶点着色器和片段着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将顶点着色器的源代码硬编码储存在字符串中</span></span><br><span class="line"><span class="keyword">const</span> char *vertexShaderSource = &quot;<span class="meta">#version 330 core\n&quot;</span></span><br><span class="line">                                 &quot;<span class="keyword">layout</span> (<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> aPos;\n&quot;</span><br><span class="line">                                 &quot;<span class="type">void</span> main()\n&quot;</span><br><span class="line">                                 &quot;&#123;\n&quot;</span><br><span class="line">                                 &quot;   <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(aPos.x, aPos.y, aPos.z, <span class="number">1.0</span>f);\n&quot;</span><br><span class="line">                                <span class="comment">//  &quot;   gl_PointSize = 10.0f&quot;</span></span><br><span class="line">                                 &quot;&#125;\<span class="number">0</span>&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将片段着色器的源代码硬编码储存在字符串中</span></span><br><span class="line"><span class="keyword">const</span> char *fragmentShaderSource = &quot;<span class="meta">#version 330 core\n&quot;</span></span><br><span class="line">                                   &quot;<span class="keyword">out</span> <span class="type">vec4</span> FragColor;\n&quot;</span><br><span class="line">                                   &quot;<span class="type">void</span> main()\n&quot;</span><br><span class="line">                                   &quot;&#123;\n&quot;</span><br><span class="line">                                   &quot;    FragColor = <span class="type">vec4</span>(<span class="number">1.0</span>f, <span class="number">0.5</span>f, <span class="number">0.2</span>f, <span class="number">1.0</span>f);\n&quot;</span><br><span class="line">                                   &quot;&#125;\<span class="number">0</span>&quot;;</span><br></pre></td></tr></table></figure>

<p>顶点拥有很多顶点属性（位置、颜色、法线等），在上面的代码中为顶点位置设置了布局（index为0），方便在后续设置顶点数据指针。</p>
<p>然后我们需要定义需要传入的顶点数据：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="keyword">vertices</span>[] = </span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">-0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f,</span><br><span class="line">	<span class="number">0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f,</span><br><span class="line">	<span class="number">0.0</span>f,  <span class="number">0.5</span>f, <span class="number">0.0</span>f</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接着我们创建VBO和VAO对象，并对他们进行绑定：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建顶点缓冲对象(VBO)、顶点数组对象(VAO)</span></span><br><span class="line">unsigned <span class="type">int</span> VBO, VAO;</span><br><span class="line">glGenBuffers(<span class="number">1</span>, &amp;VBO);</span><br><span class="line">glGenVertexArrays(<span class="number">1</span>, &amp;VAO);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定VAO对象</span></span><br><span class="line">glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定到缓冲区</span></span><br><span class="line">glBindBuffer(GL_ARRAY_BUFFER, VBO);</span><br></pre></td></tr></table></figure>

<p>glBufferData是用来把用户定义的数据复制到当前绑定缓冲的函数。第一个参数是目标缓冲的类型：顶点缓冲对象（当前绑定到GL_ARRAY_BUFFER目标上）。第二个参数指定传输数据的大小(以字节为单位)，用<code>sizeof</code>计算出顶点数据大小就行。第三个参数是我们希望发送的实际数据。</p>
<p>第四个参数指定如何管理给定的数据。它有三种形式：</p>
<ul>
<li>GL_STATIC_DRAW ：数据不会或几乎不会改变。</li>
<li>GL_DYNAMIC_DRAW：数据会被改变很多。</li>
<li>GL_STREAM_DRAW ：数据每次绘制时都会改变。</li>
</ul>
<p>三角形的位置数据不会改变，每次渲染调用时都保持原样，所以使用的类型是GL_STATIC_DRAW。如果一个缓冲中的数据将频繁被改变，那么使用的类型就是GL_DYNAMIC_DRAW或GL_STREAM_DRAW，这样能确保显卡把数据放在能够高速写入的内存位置。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 填充数据</span></span><br><span class="line">glBufferData(GL_ARRAY_BUFFER, sizeof(<span class="keyword">vertices</span>), <span class="keyword">vertices</span>, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure>

<p>当有了顶点信息就可以告诉OpenGL该如何解析顶点数据了，并且我们需要启用顶点属性：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置顶点数据指针</span></span><br><span class="line">glVertexAttribPointer(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">3</span> * sizeof(<span class="type">float</span>), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line">glEnableVertexAttribArray(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>glVertexAttribPointer函数告诉OpenGL该如何解析顶点数据：</p>
<ul>
<li>第一个参数指定要配置的顶点属性布局（index）。在顶点着色器中使用<code>layout(location = 0)</code>定义了顶点位置属性的布局设置为0，所以这里我们传入0。</li>
<li>第二个参数指定顶点属性的大小。位置属性是一个<code>vec3</code>，它由3个值组成，所以大小是3。</li>
<li>第三个参数指定数据的类型。</li>
<li>第四个参数定义是否希望数据被标准化(Normalize)。如果设置为GL_TRUE，所有数据都会被映射到0（对于有符号型signed数据是-1）到1之间。</li>
<li>第五个参数叫做步长(Stride)，它告诉我们在连续的顶点属性组之间的间隔。即，从这个属性第二次出现的地方到整个数组0位置之间有多少字节。</li>
<li>最后一个参数的类型是<code>void*</code>，所以需要我们进行强制类型转换。它表示位置数据在缓冲中起始位置的偏移量(Offset)。由于位置数据在数组的开头，所以这里是0。</li>
</ul>
<p>glEnableVertexAttribArray函数告诉OpenGL启用对应布局的顶点属性。</p>
<p>在完成顶点数据的传入后就可以解绑VAO了：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解绑VAO</span></span><br><span class="line">glBindVertexArray(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>接下来需要创建着色器对象，并对着色器进行编译：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建着色器对象</span></span><br><span class="line">unsigned <span class="type">int</span> vertexShader, fragmentShader;</span><br><span class="line">vertexShader = glCreateShader(GL_VERTEX_SHADER);</span><br><span class="line">fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 附加着色器并编译</span></span><br><span class="line">glShaderSource(vertexShader, <span class="number">1</span>, &amp;vertexShaderSource, NULL);</span><br><span class="line">glCompileShader(vertexShader);</span><br><span class="line"></span><br><span class="line">glShaderSource(fragmentShader, <span class="number">1</span>, &amp;fragmentShaderSource, NULL);</span><br><span class="line">glCompileShader(fragmentShader);</span><br></pre></td></tr></table></figure>

<p>要运行我们的着色器，需要将着色器附加到程序上，所有我们要创建一个程序对象并链接着色器：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个程序对象</span></span><br><span class="line">unsigned <span class="type">int</span> shaderProgram;</span><br><span class="line">shaderProgram = glCreateProgram();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将着色器附加到程序对象上</span></span><br><span class="line">glAttachShader(shaderProgram, vertexShader);</span><br><span class="line">glAttachShader(shaderProgram, fragmentShader);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链接</span></span><br><span class="line">glLinkProgram(shaderProgram);</span><br></pre></td></tr></table></figure>

<p>然后我们就可以使用glUseProgram调用我们的着色器程序了。</p>
<p>我们在while语句中添加我们的渲染指令：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定程序和VAO对象</span></span><br><span class="line">glUseProgram(shaderProgram);</span><br><span class="line">glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制三角形</span></span><br><span class="line">glDrawArrays(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>完整的编写过程如下图所示。</p>
<img src="/2023/11/13/02-%E5%9F%BA%E7%A1%80%E7%9A%84OpenGL%E6%A1%86%E6%9E%B6/test.png" class="" title="test">

<p>完整代码如下：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &lt;glad/glad.h&gt;</span></span><br><span class="line"><span class="comment">// include顺序不可互换，glfw依赖glad引入的OpenGL头文件</span></span><br><span class="line"><span class="meta">#include &lt;GLFW/glfw3.h&gt;</span></span><br><span class="line"><span class="comment">// 输入输出流</span></span><br><span class="line"><span class="meta">#include&lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height);</span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将顶点着色器的源代码硬编码储存在字符串中</span></span><br><span class="line"><span class="keyword">const</span> char *vertexShaderSource = &quot;<span class="meta">#version 330 core\n&quot;</span></span><br><span class="line">                                 &quot;<span class="keyword">layout</span> (<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> aPos;\n&quot;</span><br><span class="line">                                 &quot;<span class="type">void</span> main()\n&quot;</span><br><span class="line">                                 &quot;&#123;\n&quot;</span><br><span class="line">                                 &quot;   <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(aPos.x, aPos.y, aPos.z, <span class="number">1.0</span>f);\n&quot;</span><br><span class="line">                                <span class="comment">//  &quot;   gl_PointSize = 10.0f&quot;</span></span><br><span class="line">                                 &quot;&#125;\<span class="number">0</span>&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将片段着色器的源代码硬编码储存在字符串中</span></span><br><span class="line"><span class="keyword">const</span> char *fragmentShaderSource = &quot;<span class="meta">#version 330 core\n&quot;</span></span><br><span class="line">                                   &quot;<span class="keyword">out</span> <span class="type">vec4</span> FragColor;\n&quot;</span><br><span class="line">                                   &quot;<span class="type">void</span> main()\n&quot;</span><br><span class="line">                                   &quot;&#123;\n&quot;</span><br><span class="line">                                   &quot;    FragColor = <span class="type">vec4</span>(<span class="number">1.0</span>f, <span class="number">0.5</span>f, <span class="number">0.2</span>f, <span class="number">1.0</span>f);\n&quot;</span><br><span class="line">                                   &quot;&#125;\<span class="number">0</span>&quot;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化GLFW</span></span><br><span class="line">    glfwInit();</span><br><span class="line">    <span class="comment">// 配置GLFWD使用的OpenGL主要和次要版本</span></span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 使用核心模式</span></span><br><span class="line">    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line">    <span class="comment">// 使用向后兼容</span></span><br><span class="line">    <span class="comment">// glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个窗口对象，设置宽高标题</span></span><br><span class="line">    GLFWwindow* window = glfwCreateWindow(<span class="number">800</span>, <span class="number">600</span>, &quot;MyWindow&quot;, NULL, NULL);</span><br><span class="line">    <span class="keyword">if</span>(window == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果为空则创建失败并打印</span></span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to create GLFW window&quot; &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 关闭线程</span></span><br><span class="line">        glfwTerminate();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知GLFW将窗口的上下文设置为当前线程的主上下文</span></span><br><span class="line">    glfwMakeContextCurrent(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果GLAD初始化失败则打印</span></span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to initialize GLAD&quot; &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置视口</span></span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启用点大小</span></span><br><span class="line">    <span class="comment">// glEnable(GL_PROGRAM_POINT_SIZE);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册窗口变化监听函数</span></span><br><span class="line">    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义顶点数组</span></span><br><span class="line">    <span class="type">float</span> <span class="keyword">vertices</span>[] = </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">-0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f,</span><br><span class="line">        <span class="number">0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f,</span><br><span class="line">        <span class="number">0.0</span>f,  <span class="number">0.5</span>f, <span class="number">0.0</span>f</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建顶点缓冲对象(VBO)、顶点数组对象(VAO)</span></span><br><span class="line">    unsigned <span class="type">int</span> VBO, VAO;</span><br><span class="line">    glGenBuffers(<span class="number">1</span>, &amp;VBO);</span><br><span class="line">    glGenVertexArrays(<span class="number">1</span>, &amp;VAO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定VAO对象</span></span><br><span class="line">    glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定到缓冲区</span></span><br><span class="line">    glBindBuffer(GL_ARRAY_BUFFER, VBO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 填充数据</span></span><br><span class="line">    glBufferData(GL_ARRAY_BUFFER, sizeof(<span class="keyword">vertices</span>), <span class="keyword">vertices</span>, GL_STATIC_DRAW);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置顶点数据指针</span></span><br><span class="line">    glVertexAttribPointer(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">3</span> * sizeof(<span class="type">float</span>), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line">    glEnableVertexAttribArray(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解绑VAO</span></span><br><span class="line">    glBindVertexArray(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建着色器对象</span></span><br><span class="line">    unsigned <span class="type">int</span> vertexShader, fragmentShader;</span><br><span class="line">    vertexShader = glCreateShader(GL_VERTEX_SHADER);</span><br><span class="line">    fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 附加着色器并编译</span></span><br><span class="line">    glShaderSource(vertexShader, <span class="number">1</span>, &amp;vertexShaderSource, NULL);</span><br><span class="line">    glCompileShader(vertexShader);</span><br><span class="line"></span><br><span class="line">    glShaderSource(fragmentShader, <span class="number">1</span>, &amp;fragmentShaderSource, NULL);</span><br><span class="line">    glCompileShader(fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检测是否编译成功</span></span><br><span class="line">    <span class="type">int</span> success;</span><br><span class="line">    char infoLog[<span class="number">512</span>];</span><br><span class="line">    glGetShaderiv(vertexShader, GL_COMPILE_STATUS, &amp;success);</span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">    &#123;</span><br><span class="line">        glGetShaderInfoLog(vertexShader, <span class="number">512</span>, NULL, infoLog);</span><br><span class="line">        std::cout&lt;&lt; &quot;ERROR::SHADER::VERTEX::COMPILATION_FAILED\n&quot; &lt;&lt; infoLog &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    glGetShaderiv(fragmentShader, GL_COMPILE_STATUS, &amp;success);</span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">    &#123;</span><br><span class="line">        glGetShaderInfoLog(fragmentShader, <span class="number">512</span>, NULL, infoLog);</span><br><span class="line">        std::cout&lt;&lt; &quot;ERROR::SHADER::FRAGMENT::COMPILATION_FAILED\n&quot; &lt;&lt; infoLog &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个程序对象</span></span><br><span class="line">    unsigned <span class="type">int</span> shaderProgram;</span><br><span class="line">    shaderProgram = glCreateProgram();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将着色器附加到程序对象上</span></span><br><span class="line">    glAttachShader(shaderProgram, vertexShader);</span><br><span class="line">    glAttachShader(shaderProgram, fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    glLinkProgram(shaderProgram);</span><br><span class="line">    glGetProgramiv(shaderProgram, GL_LINK_STATUS, &amp;success);</span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">    &#123;</span><br><span class="line">        glGetProgramInfoLog(shaderProgram, <span class="number">512</span>, NULL, infoLog);</span><br><span class="line">        std::cout&lt;&lt; &quot;ERROR::SHADER_PROGRAM_LINK_FAILED\n&quot; &lt;&lt; infoLog &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用着色器程序</span></span><br><span class="line">    glUseProgram(shaderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除着色器</span></span><br><span class="line">    glDeleteShader(vertexShader);</span><br><span class="line">    glDeleteShader(fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染循环，使GLFW退出前一直保持运行</span></span><br><span class="line">    <span class="keyword">while</span>(!glfwWindowShouldClose(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 每帧处理是否输入</span></span><br><span class="line">        processInput(window);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 渲染指令</span></span><br><span class="line">        <span class="comment">// 使用设置的颜色来清空颜色缓冲</span></span><br><span class="line">        glClearColor(<span class="number">0.2</span>f, <span class="number">0.3</span>f, <span class="number">0.3</span>f, <span class="number">1.0</span>f);</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定程序和VAO对象</span></span><br><span class="line">        glUseProgram(shaderProgram);</span><br><span class="line">        glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制三角形、线、点</span></span><br><span class="line">        glDrawArrays(GL_TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// glDrawArrays(GL_LINE_LOOP, 0, 3);</span></span><br><span class="line">        <span class="comment">// glDrawArrays(GL_POINT, 0, 3);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解绑</span></span><br><span class="line">        glBindVertexArray(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查并调用事件，交换缓冲</span></span><br><span class="line">        glfwSwapBuffers(window);</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染循环结束后，关闭线程</span></span><br><span class="line">    glfwTerminate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对窗口注册一个回调函数，在每次窗口大小被调整的时候被调用</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果输入“ESC”则关闭窗口</span></span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        glfwSetWindowShouldClose(window, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如下图所示。</p>
<img src="/2023/11/13/02-%E5%9F%BA%E7%A1%80%E7%9A%84OpenGL%E6%A1%86%E6%9E%B6/image-20231113160927100.png" class="" title="image-20231113160927100">

<p>接下来我们使用索引缓冲对象绘制一个由两个三角形组成的矩形。</p>
<p>定义顶点数组及顶点索引：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义绘制图形的顶点数组</span></span><br><span class="line"><span class="type">float</span> <span class="keyword">vertices</span>[] = </span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">0.5</span>f, <span class="number">0.5</span>f, <span class="number">0.0</span>f,   <span class="comment">// 右上角</span></span><br><span class="line">	<span class="number">0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f,  <span class="comment">// 右下角</span></span><br><span class="line">	<span class="number">-0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f, <span class="comment">// 左下角</span></span><br><span class="line">	<span class="number">-0.5</span>f, <span class="number">0.5</span>f, <span class="number">0.0</span>f   <span class="comment">// 左上角</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置顶点索引</span></span><br><span class="line">unsigned <span class="type">int</span> indices[] = </span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="comment">// 第一个三角形</span></span><br><span class="line">	<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>  <span class="comment">// 第二个三角形</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>创建EBO并绑定对象，传入数据：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建索引缓冲对象(IBO/EBO)</span></span><br><span class="line">unsigned <span class="type">int</span> EBO;</span><br><span class="line">glGenBuffers(<span class="number">1</span>, &amp;EBO);</span><br><span class="line"><span class="comment">// 绑定EBO对象</span></span><br><span class="line">glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, EBO);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 填充数据，传入顶点索引</span></span><br><span class="line">glBufferData(GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure>

<p>绘制图形：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制图形</span></span><br><span class="line">glDrawElements(GL_TRIANGLES, <span class="number">6</span>, GL_UNSIGNED_INT, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>完整代码如下：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &lt;glad/glad.h&gt;</span></span><br><span class="line"><span class="comment">// include顺序不可互换，glfw依赖glad引入的OpenGL头文件</span></span><br><span class="line"><span class="meta">#include &lt;GLFW/glfw3.h&gt;</span></span><br><span class="line"><span class="comment">// 输入输出流</span></span><br><span class="line"><span class="meta">#include&lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height);</span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将顶点着色器的源代码硬编码储存在字符串中</span></span><br><span class="line"><span class="keyword">const</span> char *vertexShaderSource = &quot;<span class="meta">#version 330 core\n&quot;</span></span><br><span class="line">                                 &quot;<span class="keyword">layout</span> (<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> aPos;\n&quot;</span><br><span class="line">                                 &quot;<span class="type">void</span> main()\n&quot;</span><br><span class="line">                                 &quot;&#123;\n&quot;</span><br><span class="line">                                 &quot;   <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(aPos.x, aPos.y, aPos.z, <span class="number">1.0</span>f);\n&quot;</span><br><span class="line">                                <span class="comment">//  &quot;   gl_PointSize = 10.0f&quot;</span></span><br><span class="line">                                 &quot;&#125;\<span class="number">0</span>&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将片段着色器的源代码硬编码储存在字符串中</span></span><br><span class="line"><span class="keyword">const</span> char *fragmentShaderSource = &quot;<span class="meta">#version 330 core\n&quot;</span></span><br><span class="line">                                   &quot;<span class="keyword">out</span> <span class="type">vec4</span> FragColor;\n&quot;</span><br><span class="line">                                   &quot;<span class="type">void</span> main()\n&quot;</span><br><span class="line">                                   &quot;&#123;\n&quot;</span><br><span class="line">                                   &quot;    FragColor = <span class="type">vec4</span>(<span class="number">1.0</span>f, <span class="number">0.5</span>f, <span class="number">0.2</span>f, <span class="number">1.0</span>f);\n&quot;</span><br><span class="line">                                   &quot;&#125;\<span class="number">0</span>&quot;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化GLFW</span></span><br><span class="line">    glfwInit();</span><br><span class="line">    <span class="comment">// 配置GLFWD使用的OpenGL主要和次要版本</span></span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 使用核心模式</span></span><br><span class="line">    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line">    <span class="comment">// 使用向后兼容</span></span><br><span class="line">    <span class="comment">// glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个窗口对象，设置宽高标题</span></span><br><span class="line">    GLFWwindow* window = glfwCreateWindow(<span class="number">800</span>, <span class="number">600</span>, &quot;MyWindow&quot;, NULL, NULL);</span><br><span class="line">    <span class="keyword">if</span>(window == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果为空则创建失败并打印</span></span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to create GLFW window&quot; &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// 关闭线程</span></span><br><span class="line">        glfwTerminate();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知GLFW将窗口的上下文设置为当前线程的主上下文</span></span><br><span class="line">    glfwMakeContextCurrent(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果GLAD初始化失败则打印</span></span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to initialize GLAD&quot; &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置视口</span></span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启用点大小</span></span><br><span class="line">    <span class="comment">// glEnable(GL_PROGRAM_POINT_SIZE);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册窗口变化监听函数</span></span><br><span class="line">    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义绘制图形的顶点数组</span></span><br><span class="line">    <span class="type">float</span> <span class="keyword">vertices</span>[] = </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0.5</span>f, <span class="number">0.5</span>f, <span class="number">0.0</span>f,   <span class="comment">// 右上角</span></span><br><span class="line">        <span class="number">0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f,  <span class="comment">// 右下角</span></span><br><span class="line">        <span class="number">-0.5</span>f, <span class="number">-0.5</span>f, <span class="number">0.0</span>f, <span class="comment">// 左下角</span></span><br><span class="line">        <span class="number">-0.5</span>f, <span class="number">0.5</span>f, <span class="number">0.0</span>f   <span class="comment">// 左上角</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置顶点索引</span></span><br><span class="line">    unsigned <span class="type">int</span> indices[] = </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="comment">// 第一个三角形</span></span><br><span class="line">        <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>  <span class="comment">// 第二个三角形</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建顶点缓冲对象(VBO)、顶点数组对象(VAO)、索引缓冲对象(IBO/EBO)</span></span><br><span class="line">    unsigned <span class="type">int</span> VBO, VAO,EBO;</span><br><span class="line">    glGenBuffers(<span class="number">1</span>, &amp;VBO);</span><br><span class="line">    glGenBuffers(<span class="number">1</span>, &amp;EBO);</span><br><span class="line">    glGenVertexArrays(<span class="number">1</span>, &amp;VAO);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定VAO对象</span></span><br><span class="line">    glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定VBO对象</span></span><br><span class="line">    glBindBuffer(GL_ARRAY_BUFFER, VBO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 填充数据,传入顶点数组</span></span><br><span class="line">    glBufferData(GL_ARRAY_BUFFER, sizeof(<span class="keyword">vertices</span>), <span class="keyword">vertices</span>, GL_STATIC_DRAW);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绑定EBO对象</span></span><br><span class="line">    glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, EBO);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 填充数据，传入顶点索引</span></span><br><span class="line">    glBufferData(GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置顶点数据指针</span></span><br><span class="line">    glVertexAttribPointer(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">3</span> * sizeof(<span class="type">float</span>), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line">    glEnableVertexAttribArray(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解绑VAO</span></span><br><span class="line">    glBindVertexArray(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建着色器对象</span></span><br><span class="line">    unsigned <span class="type">int</span> vertexShader, fragmentShader;</span><br><span class="line">    vertexShader = glCreateShader(GL_VERTEX_SHADER);</span><br><span class="line">    fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 附加着色器并编译</span></span><br><span class="line">    glShaderSource(vertexShader, <span class="number">1</span>, &amp;vertexShaderSource, NULL);</span><br><span class="line">    glCompileShader(vertexShader);</span><br><span class="line"></span><br><span class="line">    glShaderSource(fragmentShader, <span class="number">1</span>, &amp;fragmentShaderSource, NULL);</span><br><span class="line">    glCompileShader(fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检测是否编译成功</span></span><br><span class="line">    <span class="type">int</span> success;</span><br><span class="line">    char infoLog[<span class="number">512</span>];</span><br><span class="line">    glGetShaderiv(vertexShader, GL_COMPILE_STATUS, &amp;success);</span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">    &#123;</span><br><span class="line">        glGetShaderInfoLog(vertexShader, <span class="number">512</span>, NULL, infoLog);</span><br><span class="line">        std::cout&lt;&lt; &quot;ERROR::SHADER::VERTEX::COMPILATION_FAILED\n&quot; &lt;&lt; infoLog &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    glGetShaderiv(fragmentShader, GL_COMPILE_STATUS, &amp;success);</span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">    &#123;</span><br><span class="line">        glGetShaderInfoLog(fragmentShader, <span class="number">512</span>, NULL, infoLog);</span><br><span class="line">        std::cout&lt;&lt; &quot;ERROR::SHADER::FRAGMENT::COMPILATION_FAILED\n&quot; &lt;&lt; infoLog &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个程序对象</span></span><br><span class="line">    unsigned <span class="type">int</span> shaderProgram;</span><br><span class="line">    shaderProgram = glCreateProgram();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将着色器附加到程序对象上</span></span><br><span class="line">    glAttachShader(shaderProgram, vertexShader);</span><br><span class="line">    glAttachShader(shaderProgram, fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    glLinkProgram(shaderProgram);</span><br><span class="line">    glGetProgramiv(shaderProgram, GL_LINK_STATUS, &amp;success);</span><br><span class="line">    <span class="keyword">if</span>(!success)</span><br><span class="line">    &#123;</span><br><span class="line">        glGetProgramInfoLog(shaderProgram, <span class="number">512</span>, NULL, infoLog);</span><br><span class="line">        std::cout&lt;&lt; &quot;ERROR::SHADER_PROGRAM_LINK_FAILED\n&quot; &lt;&lt; infoLog &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用着色器程序</span></span><br><span class="line">    glUseProgram(shaderProgram);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除着色器</span></span><br><span class="line">    glDeleteShader(vertexShader);</span><br><span class="line">    glDeleteShader(fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置绘制模式填充(默认)或线框</span></span><br><span class="line">    glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);</span><br><span class="line">    <span class="comment">// glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染循环，使GLFW退出前一直保持运行</span></span><br><span class="line">    <span class="keyword">while</span>(!glfwWindowShouldClose(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 每帧处理是否输入</span></span><br><span class="line">        processInput(window);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 渲染指令</span></span><br><span class="line">        <span class="comment">// 使用设置的颜色来清空颜色缓冲</span></span><br><span class="line">        glClearColor(<span class="number">0.2</span>f, <span class="number">0.3</span>f, <span class="number">0.3</span>f, <span class="number">1.0</span>f);</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定程序和VAO对象</span></span><br><span class="line">        glUseProgram(shaderProgram);</span><br><span class="line">        glBindVertexArray(VAO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制图形</span></span><br><span class="line">        glDrawElements(GL_TRIANGLES, <span class="number">6</span>, GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解绑</span></span><br><span class="line">        glBindVertexArray(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查并调用事件，交换缓冲</span></span><br><span class="line">        glfwSwapBuffers(window);</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 资源释放</span></span><br><span class="line">    glDeleteVertexArrays(<span class="number">1</span>, &amp;VAO);</span><br><span class="line">    glDeleteBuffers(<span class="number">1</span>, &amp;VBO);</span><br><span class="line">    glDeleteBuffers(<span class="number">1</span>, &amp;EBO);</span><br><span class="line">    glDeleteProgram(shaderProgram);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 渲染循环结束后，关闭线程</span></span><br><span class="line">    glfwTerminate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对窗口注册一个回调函数，在每次窗口大小被调整的时候被调用</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果输入“ESC”则关闭窗口</span></span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        glfwSetWindowShouldClose(window, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如图所示。</p>
<img src="/2023/11/13/02-%E5%9F%BA%E7%A1%80%E7%9A%84OpenGL%E6%A1%86%E6%9E%B6/image-20231113162641941.png" class="" title="image-20231113162641941">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/05/%E4%BF%AE%E6%94%B9UE%E7%9A%84%E7%BC%93%E5%AD%98%E8%B7%AF%E5%BE%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/05/%E4%BF%AE%E6%94%B9UE%E7%9A%84%E7%BC%93%E5%AD%98%E8%B7%AF%E5%BE%84/" class="post-title-link" itemprop="url">修改UE的缓存路径</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-05 23:53:13" itemprop="dateCreated datePublished" datetime="2023-10-05T23:53:13+08:00">2023-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-07-20 14:43:21" itemprop="dateModified" datetime="2024-07-20T14:43:21+08:00">2024-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.首先先删除C盘下已有的UE缓存，路径在C:\Users\<del>用户名</del>\AppData\Local\UnrealEngine\Common</p>
<p>2.找到对应UE版本的安装目录下的config文件进行修改，打开UE缓存设置文件，默认路径在C:\Program Files\Epic Games\<del>UE版本</del>\Engine\Config\BaseEngine</p>
<img src="/2023/10/05/%E4%BF%AE%E6%94%B9UE%E7%9A%84%E7%BC%93%E5%AD%98%E8%B7%AF%E5%BE%84/image-20231006000803033.png" class="" title="image-20231006000803033">

<p>将该文件中的Path=”%ENGINEVERSIONAGNOSTICUSERDIR%DerivedDataCache”改为Path=”%GAMEDIR%DerivedDataCache”</p>
<img src="/2023/10/05/%E4%BF%AE%E6%94%B9UE%E7%9A%84%E7%BC%93%E5%AD%98%E8%B7%AF%E5%BE%84/image-20231006000939728.png" class="" title="image-20231006000939728">

<p>3.修改完后保存，以后UE的缓存就不会保存在C盘了（每次重装引擎或新版本都需要重新修改）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/23/01-OpenGL%E7%AE%80%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/23/01-OpenGL%E7%AE%80%E8%BF%B0/" class="post-title-link" itemprop="url">01-OpenGL简述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-23 15:15:45" itemprop="dateCreated datePublished" datetime="2023-09-23T15:15:45+08:00">2023-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-14 10:40:45" itemprop="dateModified" datetime="2023-11-14T10:40:45+08:00">2023-11-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>OpenGL一般被认为是一个API(Application Programming Interface, 应用程序编程接口)，包含了一系列可以操作图形、图像的函数，它允许我们访问GPU，调用它来更好得进行图形绘制。然而，OpenGL本身并不是一个API，它仅仅是一种图形编程规范（定义了某个函数应该传入什么参数，并返回什么，但它也不是一个类库，函数的具体实现由用户的硬件驱动去实现）。</p>
<p>OpenGL也并不是开源的，它是由各个硬件厂商实现的，他们不会公开自己的驱动源码。</p>
<p>OpenGL是跨平台的，但这并不意味着它比Direc3D更好，每个设备平台上原生的一定比通用的、跨平台的更具有针对性（例如Direc3D、Metal）。不过正是因为OpenGL是跨平台的，所以它的通用性和可移植性是最好的。</p>
<p>OpenGL的规范有两种模式，一个是核心模式，一个是兼容模式。核心模式是现代OpenGL最常用的模式，它删除了大量传统OpenGL的功能，在一些平台上，只有核心模式才能使用较新的功能；兼容模式保留了OpenGL1.0开始的所有版本的向后兼容性（本笔记只使用核心模式）。</p>
<p>Shader（着色器）是一段代码或一个程序，它不像其他程序在CPU上运行，而是在显卡（GPU）上运行的程序。</p>
<h1 id="管线和基元"><a href="#管线和基元" class="headerlink" title="管线和基元"></a>管线和基元</h1><p>GPU由大量小型可编程处理器组成，这些处理器被称为shader core，其运行的程序称为shader，每个GPU包含几十到几千个核心，这些核心聚在一起可以同时完成巨量工作。</p>
<p>图形系统被分解为多个阶段，我们称为图形管线，每个阶段用一个着色器或者固定的函数、可配置的处理块表示。下图展示了图形管线示意图。</p>
<img src="/2023/09/23/01-OpenGL%E7%AE%80%E8%BF%B0/%E7%AE%A1%E7%BA%BF.png" class="" title="管线">

<p>OpenGL中的片段是指渲染一个像素需要的所有数据，所以片段着色器是OpenGL高级效果产生的阶段，它将计算一个像素最终的颜色（通常包括光照、阴影、光的颜色等）。</p>
<p>测试与混合是指Alpha测试（物体是否透明）并对物体的颜色进行混合。</p>
<p>在一个OpenGL程序中，必须定义至少应该顶点或者片段着色器，因为GPU并没有提供默认的着色器。</p>
<p>在OpenGL中，基本的渲染单元称为基元。OpenGL支持多种基元，但基本的三种可渲染基元为点、线和三角形，我们在屏幕上看见的东西都是由基元构成的。</p>
<h1 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h1><p>OpenGL自身是一个巨大的状态机(State Machine)：一系列的变量描述OpenGL此刻应当如何运行。OpenGL的状态通常被称为OpenGL上下文(Context)。通常使用如下途径去更改OpenGL状态：设置选项，操作缓冲。最后，使用当前OpenGL上下文来渲染。</p>
<p>当使用OpenGL去画线段而不是三角形的时候，通过改变一些上下文变量来改变OpenGL状态，从而告诉OpenGL如何去绘图。一旦改变了OpenGL的状态为绘制线段，下一个绘制命令就会画出线段而不是三角形。</p>
<p>当使用OpenGL的时候，我们会遇到一些状态设置函数(State-changing Function)，这类函数将会改变上下文。以及状态使用函数(State-using Function)，这类函数会根据当前OpenGL的状态执行一些操作。只要记住OpenGL本质上是个大状态机，就能更容易理解它的大部分特性。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/" class="post-title-link" itemprop="url">00-00-在VScode中配置OpenGL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-21 10:48:13" itemprop="dateCreated datePublished" datetime="2023-09-21T10:48:13+08:00">2023-09-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-29 17:45:15" itemprop="dateModified" datetime="2023-11-29T17:45:15+08:00">2023-11-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先下载[MinGW](<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/mingw/">MinGW - Minimalist GNU for Windows download | SourceForge.net</a>)</p>
<p>下载文件后解压，双击运行guimain.exe文件</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921105739503.png" class="" title="image-20230921105739503">

<p>安装下列三个文件并更新配置</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231129155711977.png" class="" title="image-20231129155711977">

<p>安装完成后，将..\MinGW\bin添加到环境变量</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921110442456.png" class="" title="image-20230921110442456">

<p>在cmd中进行验证</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921110556502.png" class="" title="image-20230921110556502">

<p>将mingw32-make.exe创建副本重命名覆盖make.exe</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921112817561.png" class="" title="image-20230921112817561">

<p>在cmd中进行验证</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921113024702.png" class="" title="image-20230921113024702">

<p>打开VScode添加[C/C++](<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">C/C++ - Visual Studio Marketplace</a>)和[C/C++ Project Generator](<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=danielpinto8zz6.c-cpp-project-generator">C/C++ Project Generator - Visual Studio Marketplace</a>)插件</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921151743776.png" class="" title="image-20230921151743776">

<p>创建一个文件夹，并在VScode中打开，按Ctrl+Shift+P创建C++项目</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921152238812.png" class="" title="image-20230921152238812">

<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921152259595.png" class="" title="image-20230921152259595">

<p>在控制台中验证能否正常运行</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921152417704.png" class="" title="image-20230921152417704">

<p>下载[GLFW](<a target="_blank" rel="noopener" href="https://www.glfw.org/download.html">Download | GLFW</a>)</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921153030075.png" class="" title="image-20230921153030075">

<p>下载完成后解压，将GLFW文件夹、.a文件、dll文件拷贝到创建工程的对应路径下</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921153233934.png" class="" title="image-20230921153233934">

<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921153335999.png" class="" title="image-20230921153335999">

<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921153541080.png" class="" title="image-20230921153541080">

<p>打开<a href="%5Bglad.dav1d.de%5D(https://glad.dav1d.de/)">glad</a>在线生成静态库，设置好相关参数点击生成，下载zip文件</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921154202377.png" class="" title="image-20230921154202377">

<p>解压文件，在该文件夹下运行cmd命令，生成对应的文件</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc ./src/glad.c -c -I ./include/</span><br><span class="line">ar -rc libglad.a glad.o</span><br></pre></td></tr></table></figure>

<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921154631866.png" class="" title="image-20230921154631866">

<p>将GLFW文件夹、.a文件拷贝到创建工程的对应路径下</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921160808741.png" class="" title="image-20230921160808741">

<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921160950774.png" class="" title="image-20230921160950774">

<p>打开项目中的Makefile添加代码</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921223525495.png" class="" title="image-20230921223525495">

<p>在控制台进行验证</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921223602084.png" class="" title="image-20230921223602084">

<p>将下面的代码复制到main.cpp文件保存运行</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &lt;glad/glad.h&gt;</span></span><br><span class="line"><span class="meta">#include &lt;GLFW/glfw3.h&gt;</span></span><br><span class="line"><span class="meta">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height);</span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> unsigned <span class="type">int</span> SCR_WIDTH = <span class="number">800</span>;</span><br><span class="line"><span class="keyword">const</span> unsigned <span class="type">int</span> SCR_HEIGHT = <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	glfwInit();</span><br><span class="line">	glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">	glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">	glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line"></span><br><span class="line">	GLFWwindow *window = glfwCreateWindow(SCR_WIDTH, SCR_HEIGHT, &quot;LearnOpenGL&quot;, NULL, NULL);</span><br><span class="line">	<span class="keyword">if</span> (window == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;Failed to create GLFW window&quot; &lt;&lt; std::endl;</span><br><span class="line">		glfwTerminate();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	glfwMakeContextCurrent(window);</span><br><span class="line">	glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;Failed to initialize GLAD&quot; &lt;&lt; std::endl;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (!glfwWindowShouldClose(window))</span><br><span class="line">	&#123;</span><br><span class="line">        glClearColor(<span class="number">0.2</span>f, <span class="number">0.3</span>f, <span class="number">0.3</span>f, <span class="number">1.0</span>f);</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">		processInput(window);</span><br><span class="line">		glfwSwapBuffers(window);</span><br><span class="line">		glfwPollEvents();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	glfwTerminate();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> processInput(GLFWwindow *window)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">		glfwSetWindowShouldClose(window, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> framebuffer_size_callback(GLFWwindow *window, <span class="type">int</span> width, <span class="type">int</span> height)</span><br><span class="line">&#123;</span><br><span class="line">	glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如图所示，完成OpenGL的配置</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20230921223923694.png" class="" title="image-20230921223923694">

<p>为了运行文件夹下的源文件，需要在Makefile中修改：</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231129174349831.png" class="" title="image-20231129174349831">

<p>使用如下命令进行运行：</p>
<img src="/2023/09/21/00-%E5%9C%A8VScode%E4%B8%AD%E9%85%8D%E7%BD%AEOpenGL/image-20231129174502731.png" class="" title="image-20231129174502731">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/" class="post-title-link" itemprop="url">在UE中创建可移动的NPC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-07-16 14:24:16" itemprop="dateCreated datePublished" datetime="2023-07-16T14:24:16+08:00">2023-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-21 22:49:59" itemprop="dateModified" datetime="2023-09-21T22:49:59+08:00">2023-09-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-使用蓝图"><a href="#1-使用蓝图" class="headerlink" title="1.使用蓝图"></a>1.使用蓝图</h1><p>添加一个导航网格边界体积（P可以显示或隐藏区域），缩放至场景大小，作为AI活动区域</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716151859891.png" class="" title="image-20230716151859891">

<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716152034761.png" class="" title="image-20230716152034761">

<p>项目设置中可设置导航网格的生成方式</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716152409439.png" class="" title="image-20230716152409439">

<p>选择人物蓝图类，并双击打开，删除所有的事件图表、变量、摄像机和弹簧臂组件</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716152638590.png" class="" title="image-20230716152638590">

<p>创建一个自定义事件，完成蓝图绘制<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716155158267.png" class="" title="image-20230716155158267"></p>
<p>将AI蓝图类放置到场景中，注：<strong>需要禁用自动控制</strong></p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716160155134.png" class="" title="image-20230716160155134">

<h1 id="2-使用AI行为树"><a href="#2-使用AI行为树" class="headerlink" title="2.使用AI行为树"></a>2.使用AI行为树</h1><h2 id="随机移动-追逐玩家"><a href="#随机移动-追逐玩家" class="headerlink" title="随机移动/追逐玩家"></a>随机移动/追逐玩家</h2><p>同上选择人物蓝图类，并双击打开，删除所有的事件图表、变量、摄像机和弹簧臂组件，创建人工智能黑板和行为树，创建AI控制器蓝图类</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716162102046.png" class="" title="image-20230716162102046">

<p>双击打开黑板，创建两个变量，一个为布尔类型的是否看到玩家、一个为向量类型的目标位置</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716162545221.png" class="" title="image-20230716162545221">

<p>打开AI角色蓝图类，指定AI控制器</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716162929094.png" class="" title="image-20230716162929094">

<p>打开AI控制器，添加一个AI感知组件，选中在细节面板中设置，添加AI视力配置设置属性，勾选检测中立方，为其添加目标感知更新时的事件，改变黑板中的值，注：<strong>文字命名必须和黑板中变量名一致</strong></p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716163253680.png" class="" title="image-20230716163253680">

<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716163953841.png" class="" title="image-20230716163953841">

<p>打开AI行为树，绘制大致流程</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716164134574.png" class="" title="image-20230716164134574">

<p>添加黑板装饰器</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716164724421.png" class="" title="image-20230716164724421">

<p>设置两个序列，二者优先级设置为一样</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716164901765.png" class="" title="image-20230716164901765">

<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716164925437.png" class="" title="image-20230716164925437">

<p>在行为树中新建一个任务，作为随机找点任务，重载接收执行AI函数，并完成蓝图绘制</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716165421300.png" class="" title="image-20230716165421300">

<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716165738726.png" class="" title="image-20230716165738726">

<p>继续完善AI行为树</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716165836741.png" class="" title="image-20230716165836741">

<p>更新AI控制器蓝图</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716170008133.png" class="" title="image-20230716170008133">

<p>再在AI行为树中新建一个任务，重载函数并完成蓝图绘制，作为寻找玩家任务</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716173041087.png" class="" title="image-20230716173041087">

<p>继续完善AI行为树</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716173115373.png" class="" title="image-20230716173115373">

<p>现在AI可以实现追踪玩家，但是可能被玩家甩开，现在实现AI一直朝向玩家,打开AI角色蓝图类，选中CharacterMovement，取消勾选将旋转朝向运动</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716173308029.png" class="" title="image-20230716173308029">

<p>选中AI角色蓝图类自身，勾选使用控制器旋转Yaw</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716173405036.png" class="" title="image-20230716173405036">

<p>回到寻找玩家任务蓝图，更新蓝图</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716180746203.png" class="" title="image-20230716180746203">

<p>回到随机找点蓝图，更新蓝图</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716173559037.png" class="" title="image-20230716173559037">

<h2 id="定点移动"><a href="#定点移动" class="headerlink" title="定点移动"></a>定点移动</h2><p>新建一个actor蓝图类，为其添加一个样条组件</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716182108398.png" class="" title="image-20230716182108398">

<p>将其拖入场景，选中点，按Alt移动进行样条线绘制</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716182313079.png" class="" title="image-20230716182313079">

<p>同上新建AI控制器、黑板、行为树，新建任务，新建一个int变量，完成蓝图绘制</p>
<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716183401440.png" class="" title="image-20230716183401440">

<img src="/2023/07/16/%E5%9C%A8UE%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%A7%BB%E5%8A%A8%E7%9A%84NPC/image-20230716182617575.png" class="" title="image-20230716182617575">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/" class="post-title-link" itemprop="url">Maya中创建并使用张力图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-05-31 17:16:44 / 修改时间：18:12:02" itemprop="dateCreated datePublished" datetime="2023-05-31T17:16:44+08:00">2023-05-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>张力图是反映模型表面张力变化的图，用于反映模型表面拉伸和挤压的变化，其原理是通过对比一个模型变化前后的面积，判断该处是拉伸还是挤压。</p>
<p>以下是相关代码（仅作学习分享，源代码地址：<a target="_blank" rel="noopener" href="https://github.com/wiremas/tension">GitHub - wiremas/tension: tension map node for Maya</a>）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">This plugin was ported to python from C++,</span></span><br><span class="line"><span class="string">All credits by Anno Schachner</span></span><br><span class="line"><span class="string">original plugin is here https://github.com/wiremas/tension</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> maya.api.OpenMaya <span class="keyword">as</span> om2</span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"></span><br><span class="line">kPluginNodeName = <span class="string">&quot;tensionMap&quot;</span></span><br><span class="line">origAttrName = <span class="string">&quot;orig&quot;</span></span><br><span class="line">deformedAttrName = <span class="string">&#x27;deform&#x27;</span></span><br><span class="line">kPluginNodeClassify = <span class="string">&#x27;utility/general&#x27;</span></span><br><span class="line">kPluginNodeId = om2.MTypeId( <span class="number">0x86018</span> )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maya_useNewAPI</span>():</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">aOrigShape = om2.MObject()</span><br><span class="line">aDeformedShape = om2.MObject()</span><br><span class="line">aOutShape = om2.MObject()</span><br><span class="line">aColorRamp = om2.MObject()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">tensionMap</span>( om2.MPxNode ):</span><br><span class="line"></span><br><span class="line">	isDeformedDirty = <span class="literal">True</span></span><br><span class="line">	isOrigDirty = <span class="literal">True</span></span><br><span class="line">	origEdgeLenArray = []</span><br><span class="line">	deformedEdgeLenArray = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"> self </span>):</span><br><span class="line">		om2.MPxNode.__init__( self )</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">initialize_ramp</span>(<span class="params"> self, parentNode, rampObj, index, position, value, interpolation </span>):</span><br><span class="line"></span><br><span class="line">		rampPlug = om2.MPlug( parentNode, rampObj )</span><br><span class="line">		elementPlug = rampPlug.elementByLogicalIndex(index)</span><br><span class="line">		positionPlug = elementPlug.child(<span class="number">0</span>)</span><br><span class="line">		positionPlug.setFloat(position)</span><br><span class="line">		valuePlug = elementPlug.child(<span class="number">1</span>)</span><br><span class="line">		valuePlug.child(<span class="number">0</span>).setFloat(value[<span class="number">0</span>])</span><br><span class="line">		valuePlug.child(<span class="number">1</span>).setFloat(value[<span class="number">1</span>])</span><br><span class="line">		valuePlug.child(<span class="number">2</span>).setFloat(value[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">		interpPlug = elementPlug.child(<span class="number">2</span>)</span><br><span class="line">		interpPlug.setInt(interpolation)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">postConstructor</span>(<span class="params"> self </span>):</span><br><span class="line">		self.initialize_ramp( self.thisMObject(), self.aColorRamp, <span class="number">0</span>, <span class="number">0.0</span>, om2.MColor( <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span> ), <span class="number">1</span> )</span><br><span class="line">		self.initialize_ramp( self.thisMObject(), self.aColorRamp, <span class="number">1</span>, <span class="number">0.5</span>, om2.MColor( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> ), <span class="number">1</span> )</span><br><span class="line">		self.initialize_ramp( self.thisMObject(), self.aColorRamp, <span class="number">2</span>, <span class="number">1.0</span>, om2.MColor( <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span> ), <span class="number">1</span> )</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">setDependentsDirty</span>(<span class="params"> self, dirtyPlug, affectedPlugs </span>):</span><br><span class="line">		<span class="keyword">if</span> dirtyPlug.partialName() == deformedAttrName:</span><br><span class="line">			self.isDeformedDirty = <span class="literal">True</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			self.isDeformedDirty = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> dirtyPlug.partialName() == origAttrName:</span><br><span class="line">			self.isOrigDirty = <span class="literal">True</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			self.isOrigDirty = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params"> self, plug, data </span>):</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> plug == self.aOutShape:</span><br><span class="line">			thisObj = self.thisMObject()</span><br><span class="line">			origHandle = data.inputValue( self.aOrigShape )</span><br><span class="line">			deformedHandle = data.inputValue( self.aDeformedShape )</span><br><span class="line">			outHandle = data.outputValue( self.aOutShape )</span><br><span class="line">			colorAttribute = om2.MRampAttribute( thisObj, self.aColorRamp )</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> self.isOrigDirty:</span><br><span class="line">				self.origEdgeLenArray = self.getEdgeLen( origHandle )</span><br><span class="line">			<span class="keyword">if</span> self.isDeformedDirty:</span><br><span class="line">				self.deformedEdgeLenArray = self.getEdgeLen( deformedHandle )</span><br><span class="line"></span><br><span class="line">			outHandle.copy( deformedHandle )</span><br><span class="line">			outHandle.setMObject( deformedHandle.asMesh() )</span><br><span class="line"></span><br><span class="line">			outMesh = outHandle.asMesh()</span><br><span class="line">			meshFn = om2.MFnMesh( outMesh )</span><br><span class="line">			numVerts = meshFn.numVertices</span><br><span class="line">			vertColors = om2.MColorArray()</span><br><span class="line">			vertIds = om2.MIntArray()</span><br><span class="line">			vertColors.setLength( numVerts )</span><br><span class="line">			vertIds.setLength( numVerts )</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> xrange(numVerts):</span><br><span class="line">				delta = <span class="number">0</span></span><br><span class="line">				vertColor = om2.MColor()</span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">len</span>(self.origEdgeLenArray) == <span class="built_in">len</span>(self.deformedEdgeLenArray):</span><br><span class="line">					delta = ( ( self.origEdgeLenArray[i] - self.deformedEdgeLenArray[i] ) / self.origEdgeLenArray[i] ) + <span class="number">0.5</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					delta = <span class="number">0.5</span></span><br><span class="line">				vertColor = colorAttribute.getValueAtPosition(delta)</span><br><span class="line">				vertColors.__setitem__(i, vertColor )</span><br><span class="line">				vertIds.__setitem__(i, i)</span><br><span class="line">			meshFn.setVertexColors( vertColors, vertIds )</span><br><span class="line">		data.setClean( plug )</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">getEdgeLen</span>(<span class="params"> self, meshHandle </span>):</span><br><span class="line">		edgeLenArray = []</span><br><span class="line"></span><br><span class="line">		meshObj = meshHandle.asMesh()</span><br><span class="line">		edgeIter = om2.MItMeshEdge( meshObj )</span><br><span class="line">		vertIter = om2.MItMeshVertex( meshObj )</span><br><span class="line">		<span class="keyword">while</span> <span class="keyword">not</span> vertIter.isDone():</span><br><span class="line">			lengthSum = <span class="number">0.0</span></span><br><span class="line">			connectedEdges = om2.MIntArray()</span><br><span class="line">			connectedEdges = vertIter.getConnectedEdges()</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> xrange( connectedEdges.__len__() ):</span><br><span class="line">				edgeIter.setIndex( connectedEdges[i] )</span><br><span class="line">				length = edgeIter.length(om2.MSpace.kWorld)</span><br><span class="line">				lengthSum += length * <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">			lengthSum = lengthSum / connectedEdges.__len__()</span><br><span class="line">			edgeLenArray.append( lengthSum )</span><br><span class="line">			vertIter.<span class="built_in">next</span>()</span><br><span class="line">		<span class="keyword">return</span> edgeLenArray</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nodeCreator</span>():</span><br><span class="line">	<span class="keyword">return</span> tensionMap()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize</span>():</span><br><span class="line">	tAttr = om2.MFnTypedAttribute()</span><br><span class="line"></span><br><span class="line">	tensionMap.aOrigShape = tAttr.create( origAttrName, origAttrName, om2.MFnMeshData.kMesh )</span><br><span class="line">	tAttr.storable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">	tensionMap.aDeformedShape = tAttr.create( deformedAttrName, deformedAttrName, om2.MFnMeshData.kMesh )</span><br><span class="line">	tAttr.storable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">	tensionMap.aOutShape = tAttr.create( <span class="string">&quot;out&quot;</span>, <span class="string">&quot;out&quot;</span>, om2.MFnMeshData.kMesh )</span><br><span class="line">	tAttr.writable = <span class="literal">False</span></span><br><span class="line">	tAttr.storable = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">	tensionMap.aColorRamp = om2.MRampAttribute().createColorRamp(<span class="string">&quot;color&quot;</span>, <span class="string">&quot;color&quot;</span>)</span><br><span class="line">	tensionMap.addAttribute( tensionMap.aOrigShape )</span><br><span class="line">	tensionMap.addAttribute( tensionMap.aDeformedShape )</span><br><span class="line">	tensionMap.addAttribute( tensionMap.aOutShape )</span><br><span class="line">	tensionMap.addAttribute( tensionMap.aColorRamp )</span><br><span class="line">	tensionMap.attributeAffects( tensionMap.aOrigShape, tensionMap.aOutShape )</span><br><span class="line">	tensionMap.attributeAffects( tensionMap.aDeformedShape, tensionMap.aOutShape )</span><br><span class="line">	tensionMap.attributeAffects( tensionMap.aColorRamp, tensionMap.aOutShape )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># AE template that put the main attributes into the main attribute section</span></span><br><span class="line"><span class="comment">#@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AEtemplateString</span>(<span class="params">nodeName</span>):</span><br><span class="line">	templStr = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;global proc AE%sTemplate(string $nodeName)\n&#x27;</span> % nodeName</span><br><span class="line">	templStr += <span class="string">&#x27;&#123;\n&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;editorTemplate -beginScrollLayout;\n&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;	editorTemplate -beginLayout &quot;Color Remaping&quot; -collapse 0;\n&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;		AEaddRampControl( $nodeName + &quot;.color&quot; );\n&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;	editorTemplate -endLayout;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">	templStr += <span class="string">&#x27;editorTemplate -addExtraControls; // add any other attributes\n&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;editorTemplate -endScrollLayout;\n&#x27;</span></span><br><span class="line">	templStr += <span class="string">&#x27;&#125;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> templStr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initializePlugin</span>(<span class="params"> mobject </span>):</span><br><span class="line">	mplugin = om2.MFnPlugin( mobject )</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		mplugin.registerNode( kPluginNodeName, kPluginNodeId, nodeCreator, initialize )</span><br><span class="line">		om.MGlobal.executeCommand( AEtemplateString( kPluginNodeName ) )</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		sys.stderr.write( <span class="string">&quot;Failed to register node: &quot;</span> + kPluginNodeName )</span><br><span class="line">		<span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uninitializePlugin</span>(<span class="params">mobject</span>):</span><br><span class="line">	mplugin = om2.MFnPlugin( mobject )</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		mplugin.deregisterNode( kPluginNodeId )</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		sys.stderr.write( <span class="string">&#x27;Failed to deregister node: &#x27;</span> + kPluginNodeName )</span><br><span class="line">		<span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<p>1.将以上代码保存为py文件，打开maya，在插件管理器中加载代码</p>
<img src="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/image-20230531173425918.png" class="" title="image-20230531173425918">

<p>2.导入或打开绑定的物体，打开节点编辑器，在脚本编辑器运行以下python代码（创建张力图节点）</p>
<img src="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/image-20230531173735686.png" class="" title="image-20230531173735686">

<p><code>import maya.cmds as mc</code><br><code>mc.createNode(&#39;tensionMap&#39;)</code></p>
<p>3.连接张力图节点，设置颜色变化</p>
<img src="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/image-20230531180726745.png" class="" title="image-20230531180726745">

<img src="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/image-20230531180746933.png" class="" title="image-20230531180746933">

<p>效果如下（需要开启属性颜色显示）：</p>
<img src="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/image-20230531181108887.png" class="" title="image-20230531181108887">

<img src="/2023/05/31/Maya%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%BC%A0%E5%8A%9B%E5%9B%BE/%E5%BC%A0%E5%8A%9B%E5%9B%BE%E6%BC%94%E7%A4%BA.gif" class="" title="张力图演示">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/" class="post-title-link" itemprop="url">Maya中实现简单的褶皱纹理变化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-05-22 10:22:35 / 修改时间：10:23:53" itemprop="dateCreated datePublished" datetime="2023-05-22T10:22:35+08:00">2023-05-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先准备好需要的贴图（此处使用抬眉皱纹演示，中性表情和抬眉表情的颜色贴图及法线，左右眉蒙版）</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521181559601.png" class="" title="image-20230521181559601">

<p>打开含有绑定完好角色的Maya文件，选择头部模型创建两个属性（设置属性名称、类型、最大最小值、默认值）</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521183125175.png" class="" title="image-20230521183125175">

<p>打开关键帧驱动窗口，设置相应的驱动范围（最小值k一下，最大值k一下）</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521183318678.png" class="" title="image-20230521183318678">

<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521183512309.png" class="" title="image-20230521183512309">

<p>打开材质编辑器，选择头部材质，导入蒙版贴图，创建乘法节点（通过属性值驱动蒙版强度）</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521183854030.png" class="" title="image-20230521183854030">

<p>打开连接编辑器，将属性值与蒙版相乘</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521184024439.png" class="" title="image-20230521184024439">

<p>将左右蒙版的结果相加，重新生成为贴图再与一个三维向量相乘</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521184223406.png" class="" title="image-20230521184223406">

<p>将颜色和法线贴图做如下操作</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521184344616.png" class="" title="image-20230521184344616">

<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521184404136.png" class="" title="image-20230521184404136">

<p>将最终的结果与材质对应节点相连并将材质赋予头部模型</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/image-20230521184446495.png" class="" title="image-20230521184446495">

<p>最终效果</p>
<img src="/2023/05/22/Maya%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%A4%B6%E7%9A%B1%E7%BA%B9%E7%90%86%E5%8F%98%E5%8C%96/%E8%A4%B6%E7%9A%B1%E6%BC%94%E7%A4%BA.gif" class="" title="褶皱演示">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_image.png">
      <meta itemprop="name" content="OSkirito">
      <meta itemprop="description" content="CG技术的记录与分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OS's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/" class="post-title-link" itemprop="url">在UE中使用UI制作过场动画</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-05-21 12:53:36 / 修改时间：17:50:33" itemprop="dateCreated datePublished" datetime="2023-05-21T12:53:36+08:00">2023-05-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>创建一个媒体播放器，勾选创建媒体纹理</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521131324792.png" class="" title="image-20230521131324792"><img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521131506039.png" class="" title="image-20230521131506039">

<p>创建文件媒体源和媒体播放列表，进行相应的设置</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521132403049.png" class="" title="image-20230521132403049">

<p>创建一个材质，进行设置后，将媒体纹理连接到基础颜色</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521132719471.png" class="" title="image-20230521132719471">

<p>创建一个用户控件蓝图，新建画布和图像，设置调整图像层赋予媒体材质</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521133155383.png" class="" title="image-20230521133155383">

<p>在控件蓝图中创建一个类型为媒体播放器对象引用的变量，指定默认值为之前创建的媒体播放器，进行蓝图绘制</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521133744335.png" class="" title="image-20230521133744335">

<p>打开关卡蓝图，调用对应的过场动画</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521134308879.png" class="" title="image-20230521134308879">

<p>运行发现视频有了，但是没有声音，所以我们接下来就创建音效</p>
<p>首先对之前的视频进行处理，提取视频的音轨导出为wav格式并导入到项目中，选择该文件创建一个cue</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521135728756.png" class="" title="image-20230521135728756">

<p>可双击进入cue进行一些设置（衰减等），将cue放入场景中并在细节面板中取消勾选自动启用</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521140502011.png" class="" title="image-20230521140502011">

<p>在关卡蓝图中继续完善，就大功告成了</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521140730365.png" class="" title="image-20230521140730365">

<p>注：如果需要打包项目，视频文件需要严格按照UE项目规范放置（如下所示，记得在UE中修改文件路径），否则打包出去没有视频播放</p>
<img src="/2023/05/21/%E5%9C%A8UE%E4%B8%AD%E4%BD%BF%E7%94%A8UI%E5%88%B6%E4%BD%9C%E8%BF%87%E5%9C%BA%E5%8A%A8%E7%94%BB/image-20230521141327347.png" class="" title="image-20230521141327347">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="OSkirito"
      src="/images/head_image.png">
  <p class="site-author-name" itemprop="name">OSkirito</p>
  <div class="site-description" itemprop="description">CG技术的记录与分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/oskirito" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;oskirito" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2023 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">OSkirito</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
